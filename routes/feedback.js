var express = require("express");
var router = express.Router();
var pool = require("./apiConfig/pool");

router.post("/Addfeedback", function (req, res, next) {
  // console.log("REQUEST BODY OF FEEDBACK,,,,......", req.body);
  var qry = " ";

  req.body.map((item) => {
    qry += `insert into feedback set Grasping_power__c="${item.Grasping_power__c}", General_Feedback__c="${item.General_Feedback__c}", Eligibility_for_next_course__c="${item.Eligibility_for_next_course__c}", Understanding_of_checkmate_patterns__c="${item.Understanding_of_checkmate_patterns__c}", Recommendation__c="${item.Recommendation__c}", Weakness__c="${item.Weakness__c}", Understanding_of_mating_patterns__c="${item.Understanding_of_mating_patterns__c}", Understanding_of_instructive_games__c="${item.Understanding_of_instructive_games__c}", Class_participation__c="${item.Class_participation__c}", Assessment_Score__c="${item.Assessment_Score__c}", Understanding_of_Tactics__c="${item.Understanding_of_Tactics__c}", Technical_Strengths__c="${item.Technical_Strengths__c}", Areas_of_improvement__c="${item.Areas_of_improvement__c}", Understanding_of_advanced_tactics__c="${item.Understanding_of_advanced_tactics__c}", Understanding_of_positional_concepts__c="${item.Understanding_of_positional_concepts__c}", Overall_performance_in_class_till_date__c="${item.Overall_performance_in_class_till_date__c}", Calculation_ability_of_the_child__c="${item.Calculation_ability_of_the_child__c}", Potential_of_the_child__c="${item.Potential_of_the_child__c}", Enrollment__c="${item.Enrollment__c}", Level1__c="${item.Level1__c}", Id="${item.Id}", Feedback_Status__c="${item.Feedback_Status__c}", Areas_of_improvement2__c="${item.Areas_of_improvement2__c}", Areas_of_Improvement3__c="${item.Areas_of_Improvement3__c}", Areas_of_improvement4__c="${item.Areas_of_improvement4__c}", Areas_of_improvement5__c="${item.Areas_of_improvement5__c}", Assessment_Score1__c="${item.Assessment_Score1__c}", Assessment_Score3__c="${item.Assessment_Score3__c}", Assessment_Score2__c="${item.Assessment_Score2__c}", Assessment_Score4__c="${item.Assessment_Score4__c}", Assessment_score5__c="${item.Assessment_score5__c}", Assessment_score6__c="${item.Assessment_score6__c}", Assessment_Score7__c="${item.Assessment_Score7__c}", Calculation_ability__c="${item.Calculation_ability__c}", Calculation_ability1__c="${item.Calculation_ability1__c}", Calculation_ability_of_the_child2__c="${item.Calculation_ability_of_the_child2__c}", Class_participation1__c="${item.Class_participation1__c}", Class_Performance__c="${item.Class_Performance__c}", Class_Performance2__c="${item.Class_Performance2__c}", Class_performance3__c="${item.Class_performance3__c}", Class_performance4__c="${item.Class_performance4__c}", Concepts_implementation__c="${item.Concepts_implementation__c}", Concepts_implementation1__c="${item.Concepts_implementation1__c}", Eligibility_for_next_course1__c="${item.Eligibility_for_next_course1__c}", Eligibility_for_next_course2__c="${item.Eligibility_for_next_course2__c}", Eligibility_for_next_course3__c="${item.Eligibility_for_next_course3__c}", Eligibility_for_next_course4__c="${item.Eligibility_for_next_course4__c}", Eligibility_for_next_course5__c="${item.Eligibility_for_next_course5__c}", Eligibility_for_next_level__c="${item.Eligibility_for_next_level__c}", Game_strength_Out_of_10__c="${item.Game_strength_Out_of_10__c}", Game_strength_Out_of_10_1__c="${item.Game_strength_Out_of_10_1__c}", Game_strength_Out_of_10_2__c="${item.Game_strength_Out_of_10_2__c}", Game_strength_Out_of_10_3__c="${item.Game_strength_Out_of_10_3__c}", General_Feedback1__c="${item.General_Feedback1__c}", General_Feedback3__c="${item.General_Feedback3__c}", General_Feedback2__c="${item.General_Feedback2__c}", General_Feedback4__c="${item.General_Feedback4__c}", General_Feedback5__c="${item.General_Feedback5__c}", General_feedback6__c="${item.General_feedback6__c}", General_feedback7__c="${item.General_feedback7__c}", General_Feedback8__c="${item.General_Feedback8__c}", Overall_performance_in_class_till_date2__c="${item.Overall_performance_in_class_till_date2__c}", Positional_understanding__c="${item.Positional_understanding__c}", Potential_of_the_child2__c="${item.Potential_of_the_child2__c}", Practical_Skills__c="${item.Practical_Skills__c}", Recommendation2__c="${item.Recommendation2__c}", Relationship_Manager__c="${item.Relationship_Manager__c}", Strategical_Understanding__c="${item.Strategical_Understanding__c}", Studies_solving__c="${item.Studies_solving__c}", Tactical_skills__c="${item.Tactical_skills__c}", Tactical_Strength__c="${item.Tactical_Strength__c}", Tactical_strength1__c="${item.Tactical_strength1__c}", Tactical_strength2__c="${item.Tactical_strength2__c}", Technical_Strengths2__c="${item.Technical_Strengths2__c}", Theoretical_Understanding__c="${item.Theoretical_Understanding__c}", Weakness2__c="${item.Weakness2__c}", Weakness3__c="${item.Weakness3__c}", Weakness4__c="${item.Weakness4__c}", Weakness5__c="${item.Weakness5__c}", Weakness6__c="${item.Weakness6__c}" on duplicate key update Grasping_power__c="${item.Grasping_power__c}", General_Feedback__c="${item.General_Feedback__c}", Eligibility_for_next_course__c="${item.Eligibility_for_next_course__c}", Understanding_of_checkmate_patterns__c="${item.Understanding_of_checkmate_patterns__c}", Recommendation__c="${item.Recommendation__c}", Weakness__c="${item.Weakness__c}", Understanding_of_mating_patterns__c="${item.Understanding_of_mating_patterns__c}", Understanding_of_instructive_games__c="${item.Understanding_of_instructive_games__c}", Class_participation__c="${item.Class_participation__c}", Assessment_Score__c="${item.Assessment_Score__c}", Understanding_of_Tactics__c="${item.Understanding_of_Tactics__c}", Technical_Strengths__c="${item.Technical_Strengths__c}", Areas_of_improvement__c="${item.Areas_of_improvement__c}", Understanding_of_advanced_tactics__c="${item.Understanding_of_advanced_tactics__c}", Understanding_of_positional_concepts__c="${item.Understanding_of_positional_concepts__c}", Overall_performance_in_class_till_date__c="${item.Overall_performance_in_class_till_date__c}", Calculation_ability_of_the_child__c="${item.Calculation_ability_of_the_child__c}", Potential_of_the_child__c="${item.Potential_of_the_child__c}", Enrollment__c="${item.Enrollment__c}", Level1__c="${item.Level1__c}", Id="${item.Id}", Feedback_Status__c="${item.Feedback_Status__c}", Areas_of_improvement2__c="${item.Areas_of_improvement2__c}", Areas_of_Improvement3__c="${item.Areas_of_Improvement3__c}", Areas_of_improvement4__c="${item.Areas_of_improvement4__c}", Areas_of_improvement5__c="${item.Areas_of_improvement5__c}", Assessment_Score1__c="${item.Assessment_Score1__c}", Assessment_Score3__c="${item.Assessment_Score3__c}", Assessment_Score2__c="${item.Assessment_Score2__c}", Assessment_Score4__c="${item.Assessment_Score4__c}", Assessment_score5__c="${item.Assessment_score5__c}", Assessment_score6__c="${item.Assessment_score6__c}", Assessment_Score7__c="${item.Assessment_Score7__c}", Calculation_ability__c="${item.Calculation_ability__c}", Calculation_ability1__c="${item.Calculation_ability1__c}", Calculation_ability_of_the_child2__c="${item.Calculation_ability_of_the_child2__c}", Class_participation1__c="${item.Class_participation1__c}", Class_Performance__c="${item.Class_Performance__c}", Class_Performance2__c="${item.Class_Performance2__c}", Class_performance3__c="${item.Class_performance3__c}", Class_performance4__c="${item.Class_performance4__c}", Concepts_implementation__c="${item.Concepts_implementation__c}", Concepts_implementation1__c="${item.Concepts_implementation1__c}", Eligibility_for_next_course1__c="${item.Eligibility_for_next_course1__c}", Eligibility_for_next_course2__c="${item.Eligibility_for_next_course2__c}", Eligibility_for_next_course3__c="${item.Eligibility_for_next_course3__c}", Eligibility_for_next_course4__c="${item.Eligibility_for_next_course4__c}", Eligibility_for_next_course5__c="${item.Eligibility_for_next_course5__c}", Eligibility_for_next_level__c="${item.Eligibility_for_next_level__c}", Game_strength_Out_of_10__c="${item.Game_strength_Out_of_10__c}", Game_strength_Out_of_10_1__c="${item.Game_strength_Out_of_10_1__c}", Game_strength_Out_of_10_2__c="${item.Game_strength_Out_of_10_2__c}", Game_strength_Out_of_10_3__c="${item.Game_strength_Out_of_10_3__c}", General_Feedback1__c="${item.General_Feedback1__c}", General_Feedback3__c="${item.General_Feedback3__c}", General_Feedback2__c="${item.General_Feedback2__c}", General_Feedback4__c="${item.General_Feedback4__c}", General_Feedback5__c="${item.General_Feedback5__c}", General_feedback6__c="${item.General_feedback6__c}", General_feedback7__c="${item.General_feedback7__c}", General_Feedback8__c="${item.General_Feedback8__c}", Overall_performance_in_class_till_date2__c="${item.Overall_performance_in_class_till_date2__c}", Positional_understanding__c="${item.Positional_understanding__c}", Potential_of_the_child2__c="${item.Potential_of_the_child2__c}", Practical_Skills__c="${item.Practical_Skills__c}", Recommendation2__c="${item.Recommendation2__c}", Relationship_Manager__c="${item.Relationship_Manager__c}", Strategical_Understanding__c="${item.Strategical_Understanding__c}", Studies_solving__c="${item.Studies_solving__c}", Tactical_skills__c="${item.Tactical_skills__c}", Tactical_Strength__c="${item.Tactical_Strength__c}", Tactical_strength1__c="${item.Tactical_strength1__c}", Tactical_strength2__c="${item.Tactical_strength2__c}", Technical_Strengths2__c="${item.Technical_Strengths2__c}", Theoretical_Understanding__c="${item.Theoretical_Understanding__c}", Weakness2__c="${item.Weakness2__c}", Weakness3__c="${item.Weakness3__c}", Weakness4__c="${item.Weakness4__c}", Weakness5__c="${item.Weakness5__c}", Weakness6__c="${item.Weakness6__c}";`;
  });

  pool.query(qry, function (error, result) {
    if (error) {
      // console.log("Error", error);
      return res
        .status(400)
        .json({ status: false, message: "Server Error", error });
    } else {
      // console.log("RESULT OF FEEDBACK....", result);
      return res
        .status(200)
        .json({ status: true, message: "Record Save", result });
    }
  });
});

router.post("/showFeedback", (req, res) => {
  console.log("Req Body Of Show Feedback", req.body);
  var qry = `select F.*, E.Class_Type__c from feedback F join enrollment__c E on F.Enrollment__c = E.Id where E.Student__c='${req.body.id}' and F.Feedback_Status__c='Approved';`;
  pool.query(qry, (err, result) => {
    if (err) {
      console.log("errorrrr of feedback", err);
      return res.status(400).json({ status: false, message: "Server Error" });
    } else {
      console.log("result of feedback", result);
      return res
        .status(200)
        .json({ status: true, message: "Record found", result });
    }
  });
});

module.exports = router;